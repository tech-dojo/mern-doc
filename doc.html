<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Bare - Start Bootstrap Template</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/doc.css" rel="stylesheet">

    <!-- Custom CSS -->
    <style>
    body {
        padding-top: 70px;
        /* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
    }
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div  class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand"  href="./index.html">Tech Dojo React Framework</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav pull-right">
                    <li >
                        <a href="./doc.html">DOC</a>
                    </li>

                </ul>

            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container-fluid">
      <div  class="row" >
          <div class="col-lg-2 col-md-2 col-sm-2 ">
            <div class="">
            <ul class="nav nav-pills nav-stacked menuCss">
                <li >
                    <a href="#overview">Overview</a>
                </li>
                <li>
                    <a href="#gettingStarted">Getting Started</a>
                </li>
                <li>
                    <a href="#folderStructure">Folder Structure</a>
                </li>
                <li>
                    <a href="#overview">Configuration</a>
                </li>


            </ul>
          </div>
          </div>
            <div id="overview" class="col-lg-10 col-md-10 col-sm-10" style="border-left: 1px solid red; padding-left: 10px ">

               <div id="gettingStarted">
                 <h1>Overview</h1>
                    <p>We designed React Framework to be as natural as possible for a web developer to build great web application.</p>
                    <p>We focus on using the standard HTML, CSS, and Javascript, just like you’d use to build a website.</p>
                    <p>We hope you find that React Framework not only makes web application development easier and faster,
                       but we hope it makes it more fun.</p>
               </div>
               <div >
                 <h1>Getting Started</h1>
                 <br></br>
                 <h2>Prerequisites</h2>

                  <p>Before you begin, you should make sure you have installed all these prerequisites on your development machine.</p>

                  <h4><b>Node.js & npm Install</b></h4>

                        <div>
                              <ul>
                              <li>    $ sudo apt-get install curl </li>
                              <li>$ curl -sL https://deb.nodesource.com/setup | sudo bash - </li>
                              <li>$ sudo apt-get install -y nodejs </li>
                              <li>$ sudo apt-get install -y build-essential (Recommended for Linux) </li>
                              <li>$ npm install -g gulp </li>
                              <li>$ npm install --save gulp gulp-live-server </li>

                              </ul>


                          </div>

                          <h4><b>MongoDB Install</b></h4>

                                <div>
                                      <ul>
                                      <li>$ sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10</li>
                                      <li>$ echo "deb http://repo.mongodb.org/apt/ubuntu</li>
                                      <li>$(lsb_release -sc)"/mongodb-org/3.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.0.list</li>
                                      <li>$ sudo apt-get update</li>
                                      <li>$ sudo apt-get install -y mongodb-org</li>
                                      </ul>
                                  </div>
                          <h4><b>Git Install/Clone</b></h4>

                                <div>
                                      <ul>
                                      <li>$ sudo apt-get update</li>
                                      <li>$ sudo apt-get install git</li>
                                      <li>$ sudo git clone https://github.com/<i>(Clone ReactFramework)</i></li>
                                      </ul>
                                  </div>

                      <h4><b>After cloning the project from github to run the app</b></h4>



                      <div id="folderStructure">
                            <ul>
                          <p>Make sure <b>mongodb</b> is running, to run <b>mongodb</b></p>
                            <li>$ mongod</li>
                            <br></br>
                            <p>Install global dependencies with </b></p>

                            <li>$ npm install -g gulp bower react-tools browserify</li>
                            <br></br>
                            <p>Install dependencies with </p>
                            <li>$ npm install</li>
                            <br></br>
                            <p>Run app with </p>
                            <li>$ gulp serve</li>
                            </ul>
                        </div>


                 </div>

                 <div>
                   <h1>Folder Structure </h1>
                   <br></br>
                    <h2>.tmp</h2>
                    <p>This folder stores the raw javascript code in app.js for the browser to read easily.
                       Using browserify all the jsx files are compiled to app.js.</p>

                       <h2>App</h2>
                       <p>This is where all the front-end files are stored</p>

                       <h4><b>Components</b></h4>
                       <p>The components folder is where you store React JS application components,
                          to learn more about it visit the React JS components section.</p>

                          <h4><b>Images</b></h4>
                          <p>This is where the images that we will use are stored.</p>

                             <h4><b>Services</b></h4>
                             <p>All the services are stored here and if needed imported from here.</p>
                              <p> Services allow us to keep data across the lifetime of the app and also helps us
                                communicate that data in a consistent way.</p>

                                <h4><b>Stores</b></h4>
                                <p>The apps’ stores are all stored in this folder.</p>
                                  <p>Exchange of data from the front-end to the backend or vice versa happens here.</p>
                                <p>  Once the data is here, any component can use it.</p>

                                <h4><b>Index.ejs</b></h4>
                                <p>This is the main entry point of the app</p>

                                <h4><b>Main.jsx</b></h4>
                                <p>All the components gets rendered into the root file from here</p>

                                <h4><b>Style.css</b></h4>
                                <p>All the css code are written here.</p>


                                <h2>Server</h2>

                                <p>The server folder contains all the server files you use in your application,
                                   this is where you store your MVC server files.</p>


                               <h4><b>controllers</b></h4>
                                 <p>The controllers folder is where you store your Express application controllers,
                                    this is where you write your backend business logic.</p>


                              <h4><b>models</b></h4>
                                <p>The models folder is where you store your Mongoose models,
                                  this is where you define your backend models.</p>

                             <h4><b>routes</b></h4>
                               <p>The routes folder contains the Server routing configuration files, this is where you define your Express routes.</p>

                             <h4><b>strategies</b></h4>
                               <p>The strategies folder contains the strategies configuration files loaded by the passport.js file.</p>

                             <h4><b>express.js</b></h4>
                               <p>Express configuration file, it initializes & configures the Express application.</p>

                             <h4><b>passport.js</b></h4>
                               <p>Passport configuration file that initializes & configures the Passport's authentication strategies and middlewares from the strategies folder.</p>

                             <h4><b>seeds.js</b></h4>
                               <p>Seeds contain the initial data that we wanna load our website with if any.</p>

                           <h4><b>server.js</b></h4>
                             <p>Our main application file, where you initialize your Node.js application.</p>


                            <h2>Application Files</h2>

                            <h4><b>gulpfile.js</b></h4>
                              <p>Gulp definition file is where you define your grant tasks, for more information visit the Gulp section.</p>

                            <h4><b>package.json</b></h4>
                              <p>npm definition file, where you configure the backend modules you want to use, for more information visit the NPM section.</p>

                       <h2>Hidden Configuration Files</h2>

                       <h4><b>.gitignore</b></h4>
                         <p>Git ignore file, you use it to tell git what ignore in next commits.</p>
                          <p>After installation the application generates a lot of code that you don't want to include in your repository,
                            so this is where you tell git to ignore those files.</p>


                 </div>

<!-- /*********************** new component backend start**********************/ -->

             <div>
             <h2>backend for new comp </h2>


            <p>1) Create a .js file needs to be made in the models folder which is inside the server folder .
              In this file the schema of the data is defined.</p>

              <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">
     1
     2
     3
     4
     5
     6
     7
     8
     9
    10
    11
    12
    13
    14
    15
    16
    17
    18
    19
    20
    21
    22
    23
    24
    25
    26
    27
    28
    29
    30
    31</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">var</span> mongoose <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;mongoose&#39;</span>);
    <span style="color: #008800; font-weight: bold">var</span> Schema <span style="color: #333333">=</span> mongoose.Schema;
    <span style="color: #008800; font-weight: bold">var</span> ArticleSchema <span style="color: #333333">=</span> {

      title<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;&#39;</span>,
      <span style="color: #888888">//  required: &#39;Please fill Article title&#39;,</span>
        trim<span style="color: #333333">:</span> <span style="color: #008800; font-weight: bold">true</span>
      },

      content<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;&#39;</span>,
        trim<span style="color: #333333">:</span> <span style="color: #008800; font-weight: bold">true</span>
      },

      user<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> Schema.ObjectId,
        ref<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;User&#39;</span>
      },

      created<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">Date</span>,
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> <span style="color: #007020">Date</span>.now
      }
    }

    <span style="color: #008800; font-weight: bold">var</span> Article <span style="color: #333333">=</span> mongoose.model(<span style="background-color: #fff0f0">&#39;Article&#39;</span>, ArticleSchema, <span style="background-color: #fff0f0">&#39;articles&#39;</span>);
    module.exports <span style="color: #333333">=</span> Article;
  </pre></td></tr></table>

</div>

<p>fig: example article model</p>

<p>2) Make a server.routes.js file where the backend API routes are written,
  also the server.controller.js file is imported so its functions can be used. </p>
<p>  Depending on which route is called from the store, the appropriate function will run and return data if necessary.</p>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td><pre style="margin: 0; line-height: 125%">module.exports <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(app){

 <span style="color: #008800; font-weight: bold">var</span> articles <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;./../controllers/articles.server.controller.js&#39;</span>);
 <span style="color: #008800; font-weight: bold">var</span> users <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;./../controllers/users.server.controller.js&#39;</span>);

 app.route(<span style="background-color: #fff0f0">&#39;/api/articles&#39;</span>)
	.get(articles.list)
	.post(users.requiresLogin, articles.create);

  app.route(<span style="background-color: #fff0f0">&#39;/articles/api/articles/:id&#39;</span>)
	.get(articles.read)
  .<span style="color: #008800; font-weight: bold">delete</span>(users.requiresLogin, articles.<span style="color: #008800; font-weight: bold">delete</span>);

	app.route(<span style="background-color: #fff0f0">&#39;/articles/edit/api/articles/:id&#39;</span>)
	.get(articles.read)
	.put(users.requiresLogin, articles.update);


app.param(<span style="background-color: #fff0f0">&#39;id&#39;</span>, articles.articleByID);


}
</pre></td></tr></table></div>

<p>fig: backend API routes</p>

<p>The route '/api/articles' gets the list of articles and lets a user create an article if the user is logged in.
</p>

<p>The route '/articles/api/articles/:id' gets one article and lets a user delete an article if the user is logged in.</p>

<p>The route '/articles/edit/api/articles/:id' gets one article and lets a user edit an article if the user is logged in.
</p>

<p>Whenever <i>users.requiresLogin</i> is added to any route, user authentication is needed to access that route.</p>

<p>Using http “put” method and the following url <i>/articles/edit/api/articles/569cbefe877baaf001e43b7f'</i>
you can update the article with the id <i>569cbefe877baaf001e43b7f</i>.
</p>

<p>Using http “get” method and the following url <i>'/articles/api/articles/569cbefe877baaf001e43b7f</i>
you can retrieve the article with the id <i>569cbefe877baaf001e43b7f</i>.
</p>


<p>Using http “post” method and the following url '/api/articles'
you can create an article.
</p>

<p>Using http “delete” method and the following url <i>'/articles/api/articles/569cbefe877baaf001e43b7f</i>
you can delete the article with the id <i>569cbefe877baaf001e43b7f</i>.
</p>


<p>app.param gets a single article from the database if the url param contains an id.</p>


<p>3) Make a server.controller.js file in the controllers folder where the CRUD operation functions are defined. </p>
<p> The file from the models folder needs to be imported to this file in order to save, update and delete data.</p>
<p> This file provides all the functions that the server.routes.js uses such as list, create, etc.</p>


<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">var</span> mongoose <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;mongoose&#39;</span>);
<span style="color: #008800; font-weight: bold">var</span> Article <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;./../models/Article.js&#39;</span>);
<span style="color: #008800; font-weight: bold">var</span> _ <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;lodash&#39;</span>);

module.exports.list <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(req, res) {
  Article.find(<span style="color: #008800; font-weight: bold">function</span>(error, data) {
    <span style="color: #008800; font-weight: bold">if</span> (error) {} <span style="color: #008800; font-weight: bold">else</span> {
      res.send(data);
    }
  });
};

module.exports.create <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(req, res) {
  <span style="color: #008800; font-weight: bold">var</span> article <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Article(req.body);
  article.user <span style="color: #333333">=</span> req.user;
  article.save(<span style="color: #008800; font-weight: bold">function</span>(err, data) {
    <span style="color: #008800; font-weight: bold">if</span> (err) {
      res.status(<span style="color: #0000DD; font-weight: bold">501</span>).send();
    } <span style="color: #008800; font-weight: bold">else</span> {
      res.status(<span style="color: #0000DD; font-weight: bold">200</span>).send(data);
    }
  });
};

module.exports.read <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(req, res) {
  res.json(req.article);
};


exports.<span style="color: #008800; font-weight: bold">delete</span> <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(req, res) {
	<span style="color: #008800; font-weight: bold">var</span> article <span style="color: #333333">=</span> req.article;
	article.remove(<span style="color: #008800; font-weight: bold">function</span>(err) {
		<span style="color: #008800; font-weight: bold">if</span> (err) {
			<span style="color: #008800; font-weight: bold">return</span> res.status(<span style="color: #0000DD; font-weight: bold">400</span>).send();
		} <span style="color: #008800; font-weight: bold">else</span> {
			res.json(article);
		}
	});
};


module.exports.update <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(req, res) {
  <span style="color: #008800; font-weight: bold">var</span> article <span style="color: #333333">=</span> req.article;

  	article <span style="color: #333333">=</span> _.extend(article, req.body);

  	article.save(<span style="color: #008800; font-weight: bold">function</span>(err) {
  		<span style="color: #008800; font-weight: bold">if</span> (err) {
  			<span style="color: #008800; font-weight: bold">return</span> res.status(<span style="color: #0000DD; font-weight: bold">400</span>).send();
  		} <span style="color: #008800; font-weight: bold">else</span> {
  			res.json(article);
  		}
  	});
};

exports.articleByID <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(req, res, next, id) {
	Article.findById(id).populate(<span style="background-color: #fff0f0">&#39;user&#39;</span>, <span style="background-color: #fff0f0">&#39;email&#39;</span>).exec(<span style="color: #008800; font-weight: bold">function</span>(err, article) {
		<span style="color: #008800; font-weight: bold">if</span> (err) <span style="color: #008800; font-weight: bold">return</span> next(err);
		<span style="color: #008800; font-weight: bold">if</span> (<span style="color: #333333">!</span>article) <span style="color: #008800; font-weight: bold">return</span> next(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #007020">Error</span>(<span style="background-color: #fff0f0">&#39;Failed to load article &#39;</span> <span style="color: #333333">+</span> id));
		req.article <span style="color: #333333">=</span> article;
		next();
	});
};
</pre></td></tr></table></div>


<p>list() gives the user the list of articles.</p>

<p>create() lets the user create an article by calling the save method on the model.</p>

<p>edit() lets the user edit an article by calling the save method on the model after changing the original data into the the edited one which came from req.body.</p>

<p>delete() lets the user delete an article by calling the remove method on the model.</p>

<p>articleByID() finds a single article based on id for edit() or delete() to use.</p>


<p>An example of the json format of the data that returned when <i>http://localhost:9001/api/articles</i> is called is given below:</p>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #FF0000; background-color: #FFAAAA">:</span>
{
<span style="color: #007700">&quot;_id&quot;</span>: <span style="background-color: #fff0f0">&quot;569cbefe877baaf001e43b7f&quot;</span>
<span style="background-color: #fff0f0">&quot;user&quot;</span>: <span style="background-color: #fff0f0">&quot;569cbefe877baaf001e43b7e&quot;</span>
<span style="background-color: #fff0f0">&quot;__v&quot;</span>: <span style="color: #0000DD; font-weight: bold">0</span>
<span style="background-color: #fff0f0">&quot;created&quot;</span>: <span style="background-color: #fff0f0">&quot;2016-01-18T10:31:26.834Z&quot;</span>
<span style="background-color: #fff0f0">&quot;content&quot;</span>: <span style="background-color: #fff0f0">&quot;content for article 1&quot;</span>
<span style="background-color: #fff0f0">&quot;title&quot;</span>: <span style="background-color: #fff0f0">&quot;article 1&quot;</span>
}
<span style="color: #FF0000; background-color: #FFAAAA">-</span>
<span style="color: #0000DD; font-weight: bold">1</span><span style="color: #FF0000; background-color: #FFAAAA">:</span>
{
<span style="color: #007700">&quot;_id&quot;</span>: <span style="background-color: #fff0f0">&quot;569cbefe877baaf001e43b80&quot;</span>
<span style="background-color: #fff0f0">&quot;user&quot;</span>: <span style="background-color: #fff0f0">&quot;569cbefe877baaf001e43b7e&quot;</span>
<span style="background-color: #fff0f0">&quot;__v&quot;</span>: <span style="color: #0000DD; font-weight: bold">0</span>
<span style="background-color: #fff0f0">&quot;created&quot;</span>: <span style="background-color: #fff0f0">&quot;2016-01-18T10:31:26.836Z&quot;</span>
<span style="background-color: #fff0f0">&quot;content&quot;</span>: <span style="background-color: #fff0f0">&quot;content for article 2&quot;</span>
<span style="background-color: #fff0f0">&quot;title&quot;</span>: <span style="background-color: #fff0f0">&quot;article 2&quot;</span>
}
<span style="color: #FF0000; background-color: #FFAAAA">-</span>
<span style="color: #0000DD; font-weight: bold">2</span><span style="color: #FF0000; background-color: #FFAAAA">:</span>
{
<span style="color: #007700">&quot;_id&quot;</span>: <span style="background-color: #fff0f0">&quot;569cbefe877baaf001e43b81&quot;</span>
<span style="background-color: #fff0f0">&quot;user&quot;</span>: <span style="background-color: #fff0f0">&quot;569cbefe877baaf001e43b7e&quot;</span>
<span style="background-color: #fff0f0">&quot;__v&quot;</span>: <span style="color: #0000DD; font-weight: bold">0</span>
<span style="background-color: #fff0f0">&quot;created&quot;</span>: <span style="background-color: #fff0f0">&quot;2016-01-18T10:31:26.836Z&quot;</span>
<span style="background-color: #fff0f0">&quot;content&quot;</span>: <span style="background-color: #fff0f0">&quot;content for article 3&quot;</span>
<span style="background-color: #fff0f0">&quot;title&quot;</span>: <span style="background-color: #fff0f0">&quot;article 3&quot;</span>
}
</pre></td></tr></table></div>

           </div>


           <!-- /*********************** new component backend end **********************/ -->


                  <!-- /*********************** new signup backend **********************/ -->
<div>

<p>1) Create a .js file needs to be made in the models folder which is inside the server folder.</p>
<p>. In this file the schema of the data is defined.</p>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">var</span> mongoose <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;mongoose&#39;</span>),
    Schema <span style="color: #333333">=</span> mongoose.Schema,
    crypto <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;crypto&#39;</span>);

<span style="color: #888888">/**</span>
<span style="color: #888888"> * A Validation function for local strategy properties</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">var</span> validateLocalStrategyProperty <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(property) {
    <span style="color: #008800; font-weight: bold">return</span> ((<span style="color: #008800; font-weight: bold">this</span>.provider <span style="color: #333333">!==</span> <span style="background-color: #fff0f0">&#39;local&#39;</span> <span style="color: #333333">&amp;&amp;</span> <span style="color: #333333">!</span><span style="color: #008800; font-weight: bold">this</span>.updated) <span style="color: #333333">||</span> property.length);
};

<span style="color: #888888">/**</span>
<span style="color: #888888"> * A Validation function for local strategy password</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">var</span> validateLocalStrategyPassword <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(password) {
    <span style="color: #008800; font-weight: bold">return</span> (<span style="color: #008800; font-weight: bold">this</span>.provider <span style="color: #333333">!==</span> <span style="background-color: #fff0f0">&#39;local&#39;</span> <span style="color: #333333">||</span> (password <span style="color: #333333">&amp;&amp;</span> password.length <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">6</span>));
};

<span style="color: #888888">/**</span>
<span style="color: #888888"> * User Schema</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">var</span> UserSchema <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Schema({

    firstName<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        trim<span style="color: #333333">:</span> <span style="color: #008800; font-weight: bold">true</span>,
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;&#39;</span>
            <span style="color: #888888">//validate: [validateLocalStrategyProperty, &#39;Please fill in your first name&#39;]</span>
    },
    lastName<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        trim<span style="color: #333333">:</span> <span style="color: #008800; font-weight: bold">true</span>,
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;&#39;</span>
            <span style="color: #888888">//validate: [validateLocalStrategyProperty, &#39;Please fill in your last name&#39;]</span>
    },

    displayName<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        trim<span style="color: #333333">:</span> <span style="color: #008800; font-weight: bold">true</span>
    },
    email<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        trim<span style="color: #333333">:</span> <span style="color: #008800; font-weight: bold">true</span>,
        unique<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;Email already exists&#39;</span>,

        <span style="color: #888888">//validate: [validateLocalStrategyProperty, &#39;Please fill in your email&#39;],</span>
        match<span style="color: #333333">:</span> [<span style="color: #000000; background-color: #fff0ff">/.+\@.+\..+/</span>, <span style="background-color: #fff0f0">&#39;Please fill a valid email address&#39;</span>]
    },
    username<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        <span style="color: #888888">//unique: true,</span>
        <span style="color: #888888">//required: &#39;Please fill in a username&#39;,</span>
        trim<span style="color: #333333">:</span> <span style="color: #008800; font-weight: bold">true</span>
    },
    photo<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;http://www.ee-ip.org/sites/default/files/default_images/default-user.png&#39;</span>,
        trim<span style="color: #333333">:</span> <span style="color: #008800; font-weight: bold">true</span>
    },
    description<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;&#39;</span>,
        trim<span style="color: #333333">:</span> <span style="color: #008800; font-weight: bold">true</span>
    },
    linkedin<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;&#39;</span>,
        trim<span style="color: #333333">:</span> <span style="color: #008800; font-weight: bold">true</span>
    },
    twitter<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;&#39;</span>,
        trim<span style="color: #333333">:</span> <span style="color: #008800; font-weight: bold">true</span>
    },
    password<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;&#39;</span>,
        validate<span style="color: #333333">:</span> [validateLocalStrategyPassword, <span style="background-color: #fff0f0">&#39;Password should be longer&#39;</span>]
    },
    salt<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>
    },
    provider<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
        required<span style="color: #333333">:</span> <span style="background-color: #fff0f0">&#39;Provider is required&#39;</span>
    },
    providerData<span style="color: #333333">:</span> {},
    additionalProvidersData<span style="color: #333333">:</span> {},
    roles<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> [{
            type<span style="color: #333333">:</span> <span style="color: #007020">String</span>,
            <span style="color: #008800; font-weight: bold">enum</span><span style="color: #333333">:</span> [<span style="background-color: #fff0f0">&#39;user&#39;</span>, <span style="background-color: #fff0f0">&#39;admin&#39;</span>]
        }],
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> [<span style="background-color: #fff0f0">&#39;user&#39;</span>]
    },
    updated<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">Date</span>
    },
    created<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">Date</span>,
        <span style="color: #008800; font-weight: bold">default</span><span style="color: #333333">:</span> <span style="color: #007020">Date</span>.now
    },
    <span style="color: #888888">/* For reset password */</span>
    resetPasswordToken<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">String</span>
    },
    resetPasswordExpires<span style="color: #333333">:</span> {
        type<span style="color: #333333">:</span> <span style="color: #007020">Date</span>
    }
});

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Hook a pre save method to hash the password</span>
<span style="color: #888888"> */</span>
UserSchema.pre(<span style="background-color: #fff0f0">&#39;save&#39;</span>, <span style="color: #008800; font-weight: bold">function</span>(next) {
    <span style="color: #008800; font-weight: bold">if</span> (<span style="color: #008800; font-weight: bold">this</span>.password <span style="color: #333333">&amp;&amp;</span> <span style="color: #008800; font-weight: bold">this</span>.password.length <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">6</span>) {
        <span style="color: #008800; font-weight: bold">this</span>.salt <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Buffer(crypto.randomBytes(<span style="color: #0000DD; font-weight: bold">16</span>).toString(<span style="background-color: #fff0f0">&#39;base64&#39;</span>), <span style="background-color: #fff0f0">&#39;base64&#39;</span>);
        <span style="color: #008800; font-weight: bold">this</span>.password <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">this</span>.hashPassword(<span style="color: #008800; font-weight: bold">this</span>.password);
    }

    next();
});

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Create instance method for hashing a password</span>
<span style="color: #888888"> */</span>
UserSchema.methods.hashPassword <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(password) {
    <span style="color: #008800; font-weight: bold">if</span> (<span style="color: #008800; font-weight: bold">this</span>.salt <span style="color: #333333">&amp;&amp;</span> password) {
        <span style="color: #008800; font-weight: bold">return</span> crypto.pbkdf2Sync(password, <span style="color: #008800; font-weight: bold">this</span>.salt, <span style="color: #0000DD; font-weight: bold">10000</span>, <span style="color: #0000DD; font-weight: bold">64</span>).toString(<span style="background-color: #fff0f0">&#39;base64&#39;</span>);
    } <span style="color: #008800; font-weight: bold">else</span> {
        <span style="color: #008800; font-weight: bold">return</span> password;
    }
};

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Create instance method for authenticating user</span>
<span style="color: #888888"> */</span>
UserSchema.methods.authenticate <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(password) {
    <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">this</span>.password <span style="color: #333333">===</span> <span style="color: #008800; font-weight: bold">this</span>.hashPassword(password);
};


<span style="color: #008800; font-weight: bold">var</span> User <span style="color: #333333">=</span> mongoose.model(<span style="background-color: #fff0f0">&#39;User&#39;</span>, UserSchema);
module.exports <span style="color: #333333">=</span> User;
</pre></td></tr></table></div>

<p>fig: example user model</p>

<p>2) Make a server.routes.js file where the backend API routes are written, also the server.controller.js file is imported so its functions can be used.</p>
<p>Depending on which route is called from the store, the appropriate function will run and return data if necessary.</p>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">var</span> passport <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;passport&#39;</span>);

module.exports <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(app) {
	<span style="color: #888888">// User Routes</span>
	<span style="color: #008800; font-weight: bold">var</span> users <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;./../controllers/users.server.controller&#39;</span>);

	<span style="color: #888888">// Setting up the users profile api</span>
	app.route(<span style="background-color: #fff0f0">&#39;/users/me&#39;</span>).get(users.me);
	app.route(<span style="background-color: #fff0f0">&#39;/users/:userId&#39;</span>).get(users.read);
	app.route(<span style="background-color: #fff0f0">&#39;/users/:userId&#39;</span>).put(users.update);
	app.route(<span style="background-color: #fff0f0">&#39;/users/accounts&#39;</span>).<span style="color: #008800; font-weight: bold">delete</span>(users.removeOAuthProvider);

	<span style="color: #888888">// Setting up the users password api</span>
	app.route(<span style="background-color: #fff0f0">&#39;/users/password&#39;</span>).post(users.changePassword);
	app.route(<span style="background-color: #fff0f0">&#39;/auth/forgot&#39;</span>).post(users.forgot);
	app.route(<span style="background-color: #fff0f0">&#39;/auth/reset/:token&#39;</span>).get(users.validateResetToken);
	app.route(<span style="background-color: #fff0f0">&#39;/auth/reset/:token&#39;</span>).post(users.reset);

	<span style="color: #888888">// Setting up the users authentication api</span>
	app.route(<span style="background-color: #fff0f0">&#39;/auth/signup&#39;</span>).post(users.signup);
	app.route(<span style="background-color: #fff0f0">&#39;/auth/signin&#39;</span>).post(users.signin);
	app.route(<span style="background-color: #fff0f0">&#39;/auth/signout&#39;</span>).get(users.signout);

	app.param(<span style="background-color: #fff0f0">&#39;userId&#39;</span>, users.userByID);
};
</pre></td></tr></table></div>


<p>fig: backend API routes</p>

<p>The route <i>'/auth/signup'</i> helps a user get signup and get signed in.</p>

<p>The route <i>'/auth/signin'</i> helps a user get signed in.</p>

<p>The route <i>'/auth/signout'</i> helps a user signout.</p>


<p>app.param gets a single user from the database if the url param contains an id.</p>


<p>3) Make a users.server.controller.js file in the controllers folder where the all the user related controllers are required.</p>
<p>This file gives access all the functions that the server.routes.js uses such as signin, signout, etc.</p>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">var</span> _ <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;lodash&#39;</span>);

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Extend user&#39;s controller</span>
<span style="color: #888888"> */</span>
module.exports <span style="color: #333333">=</span> _.extend(
	require(<span style="background-color: #fff0f0">&#39;./users/users.authentication.server.controller&#39;</span>),
	require(<span style="background-color: #fff0f0">&#39;./users/users.authorization.server.controller&#39;</span>),
	require(<span style="background-color: #fff0f0">&#39;./users/users.password.server.controller&#39;</span>),
	require(<span style="background-color: #fff0f0">&#39;./users/users.profile.server.controller&#39;</span>)
);
</pre></td></tr></table></div>

<p>4) In the controllers folder, inside the user folder are files that are mentioned above.</p>
<p>Using the functions in users.authentication.server.controller we signin, signout and signup.</p>

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">var</span> _ <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;lodash&#39;</span>),
	errorHandler <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;../errors.server.controller&#39;</span>),
	mongoose <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;mongoose&#39;</span>),
	passport <span style="color: #333333">=</span> require(<span style="background-color: #fff0f0">&#39;passport&#39;</span>),
	User <span style="color: #333333">=</span> mongoose.model(<span style="background-color: #fff0f0">&#39;User&#39;</span>);

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Signup</span>
<span style="color: #888888"> */</span>
exports.signup <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(req, res) {
	<span style="color: #888888">// For security measurement we remove the roles from the req.body object</span>
	<span style="color: #008800; font-weight: bold">delete</span> req.body.roles;

	<span style="color: #888888">// Init Variables</span>
	<span style="color: #008800; font-weight: bold">var</span> user <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> User(req.body);
	<span style="color: #008800; font-weight: bold">var</span> message <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">null</span>;

	<span style="color: #888888">// Add missing user fields</span>
	user.provider <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;local&#39;</span>;
	<span style="color: #888888">//user.displayName = user.firstName + &#39; &#39; + user.lastName;</span>
	<span style="color: #888888">//user.displayName =user.fullName;</span>
	<span style="color: #888888">// Then save the user</span>
	user.save(<span style="color: #008800; font-weight: bold">function</span>(err) {
		<span style="color: #008800; font-weight: bold">if</span> (err) {
			<span style="color: #008800; font-weight: bold">return</span> res.status(<span style="color: #0000DD; font-weight: bold">400</span>).send({
				message<span style="color: #333333">:</span> errorHandler.getErrorMessage(err)
			});
		} <span style="color: #008800; font-weight: bold">else</span> {
			<span style="color: #888888">// Remove sensitive data before login</span>
			user.password <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">undefined</span>;
			user.salt <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">undefined</span>;

			req.login(user, <span style="color: #008800; font-weight: bold">function</span>(err) {
				<span style="color: #008800; font-weight: bold">if</span> (err) {
					res.status(<span style="color: #0000DD; font-weight: bold">400</span>).send(err);
				} <span style="color: #008800; font-weight: bold">else</span> {
					res.json(user);
				}
			});
		}
	});
};

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Signin after passport authentication</span>
<span style="color: #888888"> */</span>
exports.signin <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(req, res, next) {
	console.log(<span style="background-color: #fff0f0">&quot;sign in &quot;</span>);
	console.log(req.body);

	passport.authenticate(<span style="background-color: #fff0f0">&#39;local&#39;</span>, <span style="color: #008800; font-weight: bold">function</span>(err, user, info) {
	<span style="color: #888888">//	console.log(user);</span>
		<span style="color: #008800; font-weight: bold">if</span> (err <span style="color: #333333">||</span> <span style="color: #333333">!</span>user) {
			console.log(err);
			res.status(<span style="color: #0000DD; font-weight: bold">400</span>).send(info);
		} <span style="color: #008800; font-weight: bold">else</span> {
			<span style="color: #888888">// Remove sensitive data before login</span>
			user.password <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">undefined</span>;
			user.salt <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">undefined</span>;

			req.login(user, <span style="color: #008800; font-weight: bold">function</span>(err) {
				<span style="color: #008800; font-weight: bold">if</span> (err) {
					res.status(<span style="color: #0000DD; font-weight: bold">400</span>).send(err);
				} <span style="color: #008800; font-weight: bold">else</span> {
					res.json(user);
				}
			});
		}
	})(req, res, next);
};

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Signout</span>
<span style="color: #888888"> */</span>
exports.signout <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">function</span>(req, res) {
	req.logout(<span style="color: #008800; font-weight: bold">function</span>(){
		<span style="color: #008800; font-weight: bold">if</span>(err){
			console.log(err);
		}
	});
	res.status(<span style="color: #0000DD; font-weight: bold">200</span>).send({message<span style="color: #333333">:</span><span style="background-color: #fff0f0">&quot;signed out&quot;</span>});
};

};
</pre></td></tr></table></div>

<p>fig: example user authentication controller</p>
</div>



                <!-- /*********************** new signup backend end **********************/ -->

            </div>

        </div>
        <!-- /.row -->

    </div>
    <!-- /.container -->

    <!-- jQuery Version 1.11.1 -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

</body>

</html>
